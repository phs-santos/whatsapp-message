<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Link WhatsApp</title>
    <link rel="stylesheet" href="./style.css">
</head>

<body>
    <div class="container">
        <h1>Gerador de Link WhatsApp</h1>

        <form id="whatsappForm">
            <label for="phone">Telefone</label>
            <input type="text" name="phone" id="phone" placeholder="(11) 99999-9999" required>

            <label for="message">Mensagem</label>
            <input type="text" name="message" id="message" minlength="3" placeholder="Oi, quero falar com você">
            <button type="submit">Gerar link</button>
        </form>

        <div id="generatedLinkContainer" class="link-container hidden">
            <p id="generatedLinkText"></p>
            <button id="copyLinkButton">Copiar link</button>
        </div>

        <div id="notification" class="notification hidden">
            Link copiado para a área de transferência!
        </div>
    </div>

    <script>
        let phoneInput = document.getElementById('phone');

        phoneInput.addEventListener('input', function (e) {
            var x = e.target.value.replace(/\D/g, '').match(/(\d{0,2})(\d{0,5})(\d{0,4})/);
            e.target.value = !x[2] ? x[1] : '(' + x[1] + ') ' + x[2] + (x[3] ? '-' + x[3] : '');
        });


        const form = document.querySelector('#whatsappForm');
        const generatedLinkContainer = document.querySelector('#generatedLinkContainer');
        const generatedLinkText = document.querySelector('#generatedLinkText');
        const copyLinkButton = document.querySelector('#copyLinkButton');
        const notification = document.querySelector('#notification');

        form.addEventListener('submit', (e) => {
            e.preventDefault();

            const phone = document.querySelector('#phone').value;
            console.log(phone);

            const phoneNoRegex = phone.replace(/\D/g, '')
            console.log(phoneNoRegex);

            const message = document.querySelector('#message').value;
            const url = `https://api.whatsapp.com/send?phone=55${phone}&text=${encodeURIComponent(message)}`;


            // Exibe o link gerado e o botão de copiar
            generatedLinkText.textContent = url;
            generatedLinkContainer.classList.remove('hidden');

            fetch(`http://api.phdevelopment.tech:9001/form-contact`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    name: "nao identificado.",
                    email: "nao identificado.",
                    phone: phoneNoRegex,
                    gender: "nao identificado.",
                    message: message || "nao identificado.",
                    application: "whats-link"
                }),
            }).then(response => {
                console.log(response);
            }).catch(error => {
                console.error(error);
            });
        });

        copyLinkButton.addEventListener('click', () => {
            // Copia o link para a área de transferência
            const link = generatedLinkText.textContent;
            navigator.clipboard.writeText(link).then(() => {
                // Exibe a notificação de link copiado
                notification.classList.remove('hidden');
                setTimeout(() => {
                    notification.classList.add('hidden');
                }, 3000); // Oculta a notificação após 3 segundos
            });
        });
    </script>
</body>

</html>